!function(e,t,n){function a(e){e&&!e.error?gapi.client.load("calendar","v3",function(){n.Calendar.Evt.trigger("haveAuthed")}):n.Calendar.Evt.trigger("shouldAuth")}var r="890138991807-okp2geobkejj9lngj22qcond9348pph8.apps.googleusercontent.com",i=["https://www.googleapis.com/auth/calendar"],o="AIzaSyBultKZZsIiFj4QrUuavwsEH6yTCQEXACQ",d="worktime";n.Calendar=function(){this.CALENDAR_ID="primary"},n.Calendar.Evt=$({}),n.Calendar.prototype.checkAuth=function(){gapi.client.setApiKey(o),gapi.auth.authorize({client_id:r,scope:i,immediate:!0},a)},n.Calendar.prototype.handleAuthClick=function(e){return gapi.auth.authorize({client_id:r,scope:i,immediate:!1},a),!1},n.Calendar.prototype.checkIsWorking=function(){if(this.checkCookies(),this.checkWorkingEvent(),!this.currentEventID)return!1;var e={calendarId:this.CALENDAR_ID,eventId:this.currentEventID};return this.getEvent(e),!0},n.Calendar.prototype.checkCookies=function(){var e=Cookies.get("PTC-calendarid");this.CALENDAR_ID=e?e:"primary"},n.Calendar.prototype.checkWorkingEvent=function(){var e={calendarId:this.CALENDAR_ID,sharedExtendedProperty:"isWorking=true"};this.getEventList(e)},n.Calendar.prototype.postAttendEvent=function(){var e=this,t=(new Date).toISOString(),n={calendarId:e.CALENDAR_ID,summary:d,start:{dateTime:t},end:{dateTime:t},extendedProperties:{shared:{isWorking:!0}}};e.postEvent(n)},n.Calendar.prototype.postLeaveEvent=function(){var e=this,t=(new Date).toISOString(),n=e.lastResponse;n.calendarId=e.CALENDAR_ID,n.eventId=e.currentEventID,n.end.dateTime=t,n.extendedProperties.shared.isWorking=!1,e.updateEvent(n)},n.Calendar.prototype.postEvent=function(e){var t=this,a=gapi.client.calendar.events.insert(e);a.execute(function(e){t.lastResponse=e,t.currentEventID=e.id,n.Calendar.Evt.trigger("posteventdone"),Cookies.set("PTC-eventid",t.currentEventID,{expires:3})})},n.Calendar.prototype.updateEvent=function(e){var t=this,a=gapi.client.calendar.events.update(e);a.execute(function(e){t.lastResponse=e,t.currentEventID=e.id,n.Calendar.Evt.trigger("updateeventdone"),Cookies.remove("PTC-eventid")})},n.Calendar.prototype.getEvent=function(e){var t=this,a=gapi.client.calendar.events.get(e);a.execute(function(e){t.lastResponse=e,n.Calendar.Evt.trigger("geteventdone")})},n.Calendar.prototype.getEventList=function(e){var t=this,a=gapi.client.calendar.events.list(e);a.execute(function(e){var a=e.items,r=a.length-1;!r||0>r||(t.lastResponse=a[r],t.currentEventID=a[r].id,n.Calendar.Evt.trigger("geteventlistdone"))})},n.Calendar.prototype.getCalendarList=function(e){var t=this;t.calendarList=[];var n=gapi.client.calendar.calendarList.list();n.execute(function(n){var a=n.items;for(var r in a)t.calendarList[r]={id:a[r].id,summary:a[r].summary};e()})},n.Calendar.prototype.setCalendarId=function(e){this.CALENDAR_ID=e,Cookies.set("PTC-calendarid",e)}}(this,document,App);